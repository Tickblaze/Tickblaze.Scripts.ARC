<ResourceDictionary
	xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">
	<ControlTemplate x:Key="{ComponentResourceKey ResourceId=TopLevelHeaderTemplateKey, TypeInTargetAssembly={x:Type MenuItem}}" TargetType="{x:Type MenuItem}">
		<Grid SnapsToDevicePixels="True">
			<!-- {TemplateBinding Background} -->
			<Rectangle
				Name="Bg"
				Margin="1"
				StrokeThickness="1"
				Fill="Blue"
				Stroke="{TemplateBinding BorderBrush}" />
			
			<ContentPresenter
				ContentSource="Header"
				RecognizesAccessKey="True"
				Margin="{TemplateBinding Padding}"
				SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}" />
			
			<Popup
				Name="PART_Popup"
				Focusable="False"
				Placement="Bottom"
				VerticalOffset="-2"
				HorizontalOffset="1"
				AllowsTransparency="True"
				IsOpen="{Binding IsSubmenuOpen , RelativeSource={RelativeSource TemplatedParent}}"
				PopupAnimation="{DynamicResource {x:Static SystemParameters.MenuPopupAnimationKey}}">
				<Grid Name="SubMenuRoot">
					<Rectangle Name="LayoutRoot" Fill="{TemplateBinding Background}" />
					
					<ContentControl
						IsTabStop="False"
						Name="SubMenuBorder"
						Template="{DynamicResource {ComponentResourceKey ResourceId=SubmenuContent, TypeInTargetAssembly={x:Type FrameworkElement}}}">
						<ScrollViewer
							Name="SubMenuScrollViewer"
							ScrollViewer.CanContentScroll="True"
							Style="{DynamicResource {ComponentResourceKey ResourceId=MenuScrollViewer, TypeInTargetAssembly={x:Type FrameworkElement}}}">
							<ItemsPresenter
								Margin="0"
								Name="ItemsPresenter"
								Grid.IsSharedSizeScope="True"
								KeyboardNavigation.TabNavigation="Cycle"
								KeyboardNavigation.DirectionalNavigation="Cycle"
								SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}" />
						</ScrollViewer>
					</ContentControl>
				</Grid>
			</Popup>
		</Grid>
		<ControlTemplate.Triggers>
			<Trigger Property="MenuItem.IsSuspendingPopupAnimation" Value="True">
				<Setter TargetName="PART_Popup" Property="PopupAnimation" Value="None" />
			</Trigger>
			
			<Trigger SourceName="PART_Popup" Property="Popup.HasDropShadow" Value="True">
				<Setter TargetName="SubMenuRoot" Property="Margin" Value="0 0 6 6" />
				<Setter TargetName="LayoutRoot" Property="UIElement.Effect" Value="{DynamicResource MahApps.DropShadowEffect.Menu}" />
			</Trigger>
			
			<Trigger Property="MenuItem.IsHighlighted" Value="True">
				<Setter TargetName="Bg" Property="Stroke" Value="{DynamicResource MahApps.Brushes.TopMenuItem.SelectionStroke}" />
			</Trigger>
			
			<Trigger Property="UIElement.IsKeyboardFocused" Value="True">
				<Setter TargetName="Bg" Property="Fill" Value="{DynamicResource MahApps.Brushes.TopMenuItem.PressedFill}" />
				<Setter TargetName="Bg" Property="Stroke" Value="{DynamicResource MahApps.Brushes.TopMenuItem.PressedStroke}" />
			</Trigger>
			
			<Trigger Property="MenuItem.IsSubmenuOpen" Value="True">
				<Setter TargetName="Bg" Property="Fill" Value="{DynamicResource MahApps.Brushes.TopMenuItem.PressedFill}" />
				<Setter TargetName="Bg" Property="Stroke" Value="{DynamicResource MahApps.Brushes.TopMenuItem.PressedStroke}" />
			</Trigger>
			
			<Trigger Property="IsEnabled" Value="False">
				<Setter Property="Foreground" Value="{DynamicResource MahApps.Brushes.MenuItem.Foreground.Disabled}" />
			</Trigger>
		</ControlTemplate.Triggers>
	</ControlTemplate>

	<ControlTemplate x:Key="{ComponentResourceKey ResourceId=TopLevelItemTemplateKey, TypeInTargetAssembly={x:Type MenuItem}}" TargetType="{x:Type MenuItem}">
		<Grid SnapsToDevicePixels="True">
			<!-- {TemplateBinding Background} -->
			<Rectangle
				Name="Bg"
				Margin="1"
				Fill="Orange"
				StrokeThickness="1"
				Stroke="{TemplateBinding BorderBrush}" />
			
			<ContentPresenter
				ContentSource="Header"
				RecognizesAccessKey="True"
				Margin="{TemplateBinding Padding}"
				SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}" />
		</Grid>
		<ControlTemplate.Triggers>
			<Trigger Property="MenuItem.IsHighlighted" Value="True">
				<Setter TargetName="Bg" Property="Stroke" Value="{DynamicResource MahApps.Brushes.TopMenuItem.SelectionStroke}" />
			</Trigger>
			
			<Trigger Property="UIElement.IsKeyboardFocused" Value="True">
				<Setter TargetName="Bg" Property="Fill" Value="{DynamicResource MahApps.Brushes.TopMenuItem.PressedFill}" />
				<Setter TargetName="Bg" Property="Stroke" Value="{DynamicResource MahApps.Brushes.TopMenuItem.PressedStroke}" />
			</Trigger>
			
			<Trigger Property="IsEnabled" Value="False">
				<Setter Property="Foreground" Value="{DynamicResource MahApps.Brushes.MenuItem.Foreground.Disabled}" />
			</Trigger>
		</ControlTemplate.Triggers>
	</ControlTemplate>

	<ControlTemplate x:Key="{ComponentResourceKey ResourceId=SubmenuHeaderTemplateKey, TypeInTargetAssembly={x:Type MenuItem}}" TargetType="{x:Type MenuItem}">
		<Grid SnapsToDevicePixels="True">
			<Rectangle
				Name="Bg"
				StrokeThickness="1"
				Fill="{TemplateBinding Background}"
				Stroke="{TemplateBinding BorderBrush}" />
			
			<Grid Margin="{TemplateBinding Padding}">
				<Grid.ColumnDefinitions>
					<ColumnDefinition Width="*" />
					<ColumnDefinition Width="Auto" SharedSizeGroup="MenuItemIGTColumnGroup" />
					<ColumnDefinition Width="17" />
				</Grid.ColumnDefinitions>
				
				<ContentPresenter
					Grid.Column="0"
					ContentSource="Header"
					RecognizesAccessKey="True"
					SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}" />
				
				<TextBlock
					Grid.Column="1"
					Visibility="Collapsed"
					Text="{TemplateBinding InputGestureText}" />
				
				<Path
					Grid.Column="3"
					Margin="4 0 0 0"
					VerticalAlignment="Center"
					Data="{DynamicResource RightArrow}"
					Fill="{DynamicResource MahApps.Brushes.RightArrowFill}" />
			</Grid>
			
			<Grid Margin="2 0 1 0">
				<Popup
					Name="PART_Popup"
					Focusable="False"
					Placement="Right"
					VerticalOffset="-1"
					HorizontalOffset="1"
					AllowsTransparency="True"
					IsOpen="{Binding IsSubmenuOpen, RelativeSource={RelativeSource TemplatedParent}}"
					PopupAnimation="{DynamicResource {x:Static SystemParameters.MenuPopupAnimationKey}}">
					<Grid Name="SubMenuRoot">
						<Rectangle Name="LayoutRoot" Fill="{TemplateBinding Background}" />
						
						<ContentControl
							IsTabStop="False"
							Name="SubMenuBorder"
							Template="{DynamicResource {ComponentResourceKey ResourceId=SubmenuContent, TypeInTargetAssembly={x:Type FrameworkElement}}}">
							<ScrollViewer
								Name="SubMenuScrollViewer"
								ScrollViewer.CanContentScroll="True"
								Style="{DynamicResource {ComponentResourceKey ResourceId=MenuScrollViewer, TypeInTargetAssembly={x:Type FrameworkElement}}}">
								<ItemsPresenter
									Margin="0"
									Name="ItemsPresenter"
									Grid.IsSharedSizeScope="True"
									KeyboardNavigation.TabNavigation="Cycle"
									KeyboardNavigation.DirectionalNavigation="Cycle"
									SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}" />
							</ScrollViewer>
						</ContentControl>
					</Grid>
				</Popup>
			</Grid>
		</Grid>
		<ControlTemplate.Triggers>
			<Trigger Property="MenuItem.IsSuspendingPopupAnimation" Value="True">
				<Setter TargetName="PART_Popup" Property="PopupAnimation" Value="None" />
			</Trigger>
			
			<Trigger SourceName="PART_Popup" Property="Popup.HasDropShadow" Value="True">
				<Setter TargetName="LayoutRoot" Property="UIElement.Effect" Value="{DynamicResource MahApps.DropShadowEffect.Menu}" />
				<Setter TargetName="SubMenuRoot" Property="Margin" Value="0 0 6 6" />
			</Trigger>
			
			<Trigger Property="MenuItem.IsHighlighted" Value="True">
				<Setter TargetName="Bg" Property="Fill" Value="{DynamicResource MahApps.Brushes.MenuItem.SelectionFill}" />
				<Setter TargetName="Bg" Property="Stroke" Value="{DynamicResource MahApps.Brushes.MenuItem.SelectionStroke}" />
			</Trigger>
			
			<Trigger Property="IsEnabled" Value="False">
				<Setter Property="Foreground" Value="{DynamicResource MahApps.Brushes.MenuItem.Foreground.Disabled}" />
			</Trigger>
		</ControlTemplate.Triggers>
	</ControlTemplate>

	<ControlTemplate x:Key="{ComponentResourceKey ResourceId=SubmenuItemTemplateKey, TypeInTargetAssembly={x:Type MenuItem}}" TargetType="{x:Type MenuItem}">
		<Grid SnapsToDevicePixels="True">
			<Rectangle
				Name="Bg"
				StrokeThickness="1"
				Fill="{TemplateBinding Background}"
				Stroke="{TemplateBinding BorderBrush}" />
			
			<Grid Margin="{TemplateBinding Padding}">
				<Grid.ColumnDefinitions>
					<ColumnDefinition Width="*" />
					<ColumnDefinition Width="Auto" SharedSizeGroup="MenuItemIGTColumnGroup" />
				</Grid.ColumnDefinitions>
				
				<ContentPresenter
					Grid.Column="0"
					ContentSource="Header"
					RecognizesAccessKey="True"
					SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}" />
				
				<TextBlock Grid.Column="1" Text="{TemplateBinding InputGestureText}" />
			</Grid>
		</Grid>
		<ControlTemplate.Triggers>
			<Trigger Property="MenuItem.IsHighlighted" Value="True">
				<Setter TargetName="Bg" Property="Fill" Value="{DynamicResource MahApps.Brushes.MenuItem.SelectionFill}" />
				<Setter TargetName="Bg" Property="Stroke" Value="{DynamicResource MahApps.Brushes.MenuItem.SelectionStroke}" />
			</Trigger>
			
			<Trigger Property="IsEnabled" Value="False">
				<Setter Property="Foreground" Value="{DynamicResource MahApps.Brushes.MenuItem.Foreground.Disabled}" />
			</Trigger>
		</ControlTemplate.Triggers>
	</ControlTemplate>

</ResourceDictionary>